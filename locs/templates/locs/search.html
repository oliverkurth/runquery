{% extends 'base.html' %}

{% block header %}
{% endblock %}

{% block content %}

<script src="static/functions.js" type="text/javascript"></script>
<script>

function display_tab(evt, tabid) {
  var i, tabcontent, tablinks;

  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tab button");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabid).style.display = "block";
  evt.currentTarget.className += " active";
}

function generate_table(table, data) {
  table.innerHTML = '';
  for (let element of data) {
    let row = table.insertRow();
    for (key of ['title', 'type', 'date', 'distance', 'gain']) {
      let cell = row.insertCell();
      let text = document.createTextNode(element[key]);
      cell.appendChild(text);
    }
  }
}

function set_search_cb(result, data) {
    document.getElementById('status').innerHTML = 'found ' + result.length + ' results';
    table = document.getElementById('activities');
    generate_table(table, result);
}

function set_search() {
    all_inputs = document.querySelectorAll('input');
    filter = {};
    for (i = 0; i < all_inputs.length; i++) {
        input = all_inputs[i];
        id = input.id;
        if (input.type == 'checkbox') {
            filter[id] = input.checked;
        } else {
            filter[id] = input.value;
        }
    }
    async_post_json('/api/set_search', filter, set_search_cb, null);
    document.getElementById('status').innerHTML = 'searching...';

    document.getElementById("btn default tab").click();
}


</script>

<table class="main">
<tr>
<td>Title contains:</td><td colspan='3'><input type='text' size='100' id='title_words'/></td>
</tr><tr>
{% for type in ['run', 'ride', 'hike', 'walk'] %}
<td>{{ type }}:<input type="checkbox" size="20" id="type_{{type}}"></td>
{% endfor %}
</tr><tr>
<td>Date after:</td><td><input type='date' size='50' id='date_after'/></td>
<td>Date before:</td><td><input type='date' size='50' id='date_before'/></td>
</tr><tr>
<td>Distance greater than:</td><td><input type='text' size='5' id='min_dist'/></td>
<td>Distance less than:</td><td><input type='text' size='5' id='max_dist'/></td>
</tr><tr>
<td>Elevation greater than:</td><td><input type='text' size='5' id='min_gain'/></td>
<td>Elevation less than:</td><td><input type='text' size='5' id='max_gain'/></td>
</tr><tr>
<td><button type="button" onclick="set_search()">Search</button></td>
<td><p id='status'></p></rd>
</tr>
</table>

<div class="tab">
  <button class="tab button" onclick='display_tab(event, "tab list")' id='btn default tab'>List</button>
  <button class="tab button" onclick='display_tab(event, "tab map")'>Map</button>
</div>

<div id="tab list" class="tabcontent">
<table class="main" id="activities">
</table>
</div>

<div id="tab map" class="tabcontent">
Map goes here.
</div>

{% endblock %}

